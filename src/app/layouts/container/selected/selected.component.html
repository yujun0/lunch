<div class="random-selector-container">
  <h2 class="title">{{ title }}</h2>

  <!-- 店家選擇區域 -->
  <div class="store-selection-area">
    <kendo-expansionpanel
      [expanded]="!isSpinning && !showResult"
      title="選擇參與抽獎的店家 ({{ checkedList.length }}/{{ checklist.length }})"
      class="expansion-panel"
    >
      <div class="store-list">
        <div *ngFor="let store of checklist" class="store-item">
          <label class="store-checkbox">
            <input
              type="checkbox"
              kendoCheckBox
              [(ngModel)]="store.isSelected"
              (change)="onStoreSelectionChange()"
              [disabled]="isSpinning"
            />
            <span class="store-name">{{ store.name }}</span>
          </label>
        </div>
      </div>
    </kendo-expansionpanel>
  </div>

  <!-- 控制按鈕 -->
  <div class="control-buttons">
    <button
      kendoButton
      iconClass="k-icon k-i-check-circle"
      themeColor="primary"
      (click)="selectAllStores()"
      [disabled]="isSpinning"
      class="control-btn"
    >
      全選
    </button>
    <button
      kendoButton
      iconClass="k-icon k-i-cancel"
      themeColor="base"
      (click)="deselectAllStores()"
      [disabled]="isSpinning"
      class="control-btn"
    >
      清除
    </button>
    <button
      kendoButton
      iconClass="k-icon k-i-refresh"
      themeColor="base"
      (click)="resetSelection()"
      *ngIf="showResult"
      class="control-btn"
    >
      重新開始
    </button>
  </div>

  <!-- 開始抽獎按鈕 -->
  <div class="start-button-container" *ngIf="!showResult">
    <button
      kendoButton
      iconClass="k-icon k-i-play"
      themeColor="success"
      (click)="startRandomSelection()"
      [disabled]="isSpinning || checkedList.length === 0"
      class="start-button"
      [class.spinning]="isSpinning"
    >
      <span *ngIf="!isSpinning">🎲 開始抽獎</span>
      <span *ngIf="isSpinning">🎯 抽獎中...</span>
    </button>
  </div>

  <!-- 抽獎輪盤區域 -->
  <div class="lottery-wheel" *ngIf="isSpinning || showResult">
    <div class="wheel-container">
      <div class="wheel-frame">
        <div class="store-display" [class.spinning]="isSpinning">
          <div class="store-image" *ngIf="getCurrentStore()">
            <img 
              [src]="getStoreImageUrl(getCurrentStore()!)" 
              [alt]="getCurrentStore()!.name"
              (error)="$any($event.target).src='assets/store/images/default.jpg'"
            />
          </div>
          <div class="store-name-display" *ngIf="getCurrentStore()">
            {{ getCurrentStore()!.name }}
          </div>
        </div>
      </div>
      <div class="wheel-pointer">📍</div>
    </div>
  </div>

  <!-- 結果顯示 -->
  <div class="result-section" *ngIf="showResult && selectedStore">
    <div class="result-card">
      <div class="result-title">🎉 恭喜！今天就吃這家：</div>
      <div class="result-store-name">{{ selectedStore?.name }}</div>
      <div class="result-actions">
        <button
          kendoButton
          themeColor="primary"
          (click)="goToGoogleMaps()"
          class="map-button"
        >
          📍 查看地圖
        </button>
      </div>
    </div>
  </div>

  <!-- 結果對話框 -->
  <kendo-dialog 
    title="🎉 抽獎結果" 
    *ngIf="opened" 
    (close)="closeDialog()"
    class="result-dialog"
  >
    <div class="dialog-content">
      <div class="dialog-store-image" *ngIf="selectedStore">
        <img 
          [src]="selectedStore ? getStoreImageUrl(selectedStore) : ''" 
          [alt]="selectedStore?.name || ''"
          (error)="$any($event.target).src='assets/store/images/default.jpg'"
        />
      </div>
      <p class="dialog-store-name">{{ selectedStore?.name }}</p>
      <p class="dialog-message">今天就決定是你了！</p>
    </div>
    <kendo-dialog-actions>
      <button kendoButton (click)="goToGoogleMaps()" themeColor="primary">
        查看地圖
      </button>
      <button kendoButton (click)="closeDialog()" themeColor="base">
        確定
      </button>
    </kendo-dialog-actions>
  </kendo-dialog>
</div>
