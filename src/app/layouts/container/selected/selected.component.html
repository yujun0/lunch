<div class="random-selector-container">
  <h2 class="title">{{ title }}</h2>

  <!-- åº—å®¶é¸æ“‡å€åŸŸ -->
  <div class="store-selection-area">
    <kendo-expansionpanel
      [expanded]="!isSpinning && !showResult"
      title="é¸æ“‡åƒèˆ‡æŠ½ççš„åº—å®¶ ({{ checkedList.length }}/{{ checklist.length }})"
      class="expansion-panel"
    >
      <div class="store-list">
        <div *ngFor="let store of checklist" class="store-item">
          <label class="store-checkbox">
            <input
              type="checkbox"
              kendoCheckBox
              [(ngModel)]="store.isSelected"
              (change)="onStoreSelectionChange()"
              [disabled]="isSpinning"
            />
            <span class="store-name">{{ store.name }}</span>
          </label>
        </div>
      </div>
    </kendo-expansionpanel>
  </div>

  <!-- æ§åˆ¶æŒ‰éˆ• -->
  <div class="control-buttons">
    <button
      kendoButton
      iconClass="k-icon k-i-check-circle"
      themeColor="primary"
      (click)="selectAllStores()"
      [disabled]="isSpinning"
      class="control-btn"
    >
      å…¨é¸
    </button>
    <button
      kendoButton
      iconClass="k-icon k-i-cancel"
      themeColor="base"
      (click)="deselectAllStores()"
      [disabled]="isSpinning"
      class="control-btn"
    >
      æ¸…é™¤
    </button>
    <button
      kendoButton
      iconClass="k-icon k-i-refresh"
      themeColor="base"
      (click)="resetSelection()"
      *ngIf="showResult"
      class="control-btn"
    >
      é‡æ–°é–‹å§‹
    </button>
  </div>

  <!-- é–‹å§‹é¸åº—æŒ‰éˆ• -->
  <div class="start-button-container" *ngIf="!showResult">
    <button
      kendoButton
      iconClass="k-icon k-i-play"
      themeColor="success"
      (click)="startRandomSelection()"
      [disabled]="isSpinning || checkedList.length === 0"
      class="start-button"
      [class.spinning]="isSpinning"
    >
      <span *ngIf="!isSpinning">ğŸ½ï¸ é–‹å§‹é¸åº—</span>
      <span *ngIf="isSpinning">ğŸ”„ é¸æ“‡ä¸­...</span>
    </button>
  </div>

  <!-- éš¨æ©Ÿé¸åº—å€åŸŸ -->
  <div class="selection-area" *ngIf="isSpinning || showResult">
    <div class="selection-container">
      <div class="selection-frame">
        <div class="store-display" [class.selecting]="isSpinning">
          <div class="store-visual" *ngIf="getCurrentStore()" 
               [style.background]="getStoreVisual(getCurrentStore()!).gradient">
            <div class="store-emoji">
              {{ getStoreVisual(getCurrentStore()!).emoji }}
            </div>
            <div class="store-initial">
              {{ getStoreInitial(getCurrentStore()!) }}
            </div>
          </div>
          <div class="store-name-display" *ngIf="getCurrentStore()">
            {{ getCurrentStore()!.name }}
          </div>
        </div>
      </div>
      <div class="selection-indicator" *ngIf="isSpinning">âš¡ å¿«é€Ÿé¸æ“‡ä¸­...</div>
      <div class="selection-indicator" *ngIf="showResult">ğŸ¯ é¸ä¸­äº†ï¼</div>
    </div>
  </div>

  <!-- çµæœé¡¯ç¤º -->
  <div class="result-section" *ngIf="showResult && selectedStore">
    <div class="result-card">
      <div class="result-title">ğŸ½ï¸ ä»Šå¤©å°±åƒé€™å®¶ï¼š</div>
      <div class="result-store-name">{{ selectedStore?.name }}</div>
      <div class="result-actions">
        <button
          kendoButton
          themeColor="primary"
          (click)="goToGoogleMaps()"
          class="map-button"
        >
          ğŸ“ æŸ¥çœ‹åœ°åœ–
        </button>
      </div>
    </div>
  </div>

  <!-- çµæœå°è©±æ¡† -->
  <kendo-dialog 
    title="ğŸ½ï¸ é¸åº—çµæœ" 
    *ngIf="opened" 
    (close)="closeDialog()"
    class="result-dialog"
  >
    <div class="dialog-content">
      <div class="dialog-store-visual" *ngIf="selectedStore"
           [style.background]="getStoreVisual(selectedStore).gradient">
        <div class="dialog-emoji">
          {{ getStoreVisual(selectedStore).emoji }}
        </div>
        <div class="dialog-initial">
          {{ getStoreInitial(selectedStore) }}
        </div>
      </div>
      <p class="dialog-store-name">{{ selectedStore?.name }}</p>
      <p class="dialog-message">ä»Šå¤©å°±åƒé€™å®¶å§ï¼</p>
    </div>
    <kendo-dialog-actions>
      <button kendoButton (click)="goToGoogleMaps()" themeColor="primary">
        æŸ¥çœ‹åœ°åœ–
      </button>
      <button kendoButton (click)="closeDialog()" themeColor="base">
        ç¢ºå®š
      </button>
    </kendo-dialog-actions>
  </kendo-dialog>
</div>
