<div class="manage-container">
  <h2 class="title">{{ title }}</h2>
  
  <!-- å·¥å…·åˆ— -->
  <div class="toolbar">
    <button 
      kendoButton 
      themeColor="success" 
      iconClass="k-icon k-i-plus"
      (click)="showAddStoreForm()"
      class="action-btn"
    >
      æ–°å¢åº—å®¶
    </button>
    
    <button 
      kendoButton 
      themeColor="base" 
      iconClass="k-icon k-i-refresh"
      (click)="resetToDefault()"
      class="action-btn"
    >
      é‡ç½®é è¨­
    </button>
    
    <button 
      kendoButton 
      themeColor="info" 
      iconClass="k-icon k-i-download"
      (click)="exportData()"
      class="action-btn"
    >
      åŒ¯å‡ºè³‡æ–™
    </button>
    
    <label class="import-btn">
      <input 
        type="file" 
        accept=".json" 
        (change)="importData($event)"
        style="display: none"
      />
      <button kendoButton themeColor="info" iconClass="k-icon k-i-upload">
        åŒ¯å…¥è³‡æ–™
      </button>
    </label>
  </div>

  <!-- åº—å®¶åˆ—è¡¨ -->
  <div class="stores-grid">
    <div *ngFor="let store of stores" class="store-card">
      <div class="store-visual-manage" 
           [style.background]="getStoreVisual(store).gradient">
        <div class="store-emoji-manage">
          {{ getStoreVisual(store).emoji }}
        </div>
        <div class="store-initial-manage">
          {{ getStoreInitial(store) }}
        </div>
      </div>
      
      <div class="store-info">
        <h3 class="store-name">{{ store.name }}</h3>
        <div class="store-type-info">
          {{ getStoreVisual(store).emoji }} {{ getStoreTypeLabel(store.type) }}
        </div>
        <div class="store-id">ID: {{ store.id }}</div>
      </div>
      
      <div class="store-actions">
        <button 
          kendoButton 
          themeColor="primary" 
          iconClass="k-icon k-i-edit"
          (click)="editStore(store)"
          class="small-btn"
          title="ç·¨è¼¯"
        >
        </button>
        
        <button 
          kendoButton 
          themeColor="base" 
          iconClass="k-icon k-i-hyperlink-globe"
          (click)="goToGoogleMaps(store.google)"
          class="small-btn"
          title="æŸ¥çœ‹åœ°åœ–"
        >
        </button>
        
        <button 
          kendoButton 
          themeColor="error" 
          iconClass="k-icon k-i-delete"
          (click)="deleteStore(store)"
          class="small-btn"
          title="åˆªé™¤"
        >
        </button>
      </div>
    </div>
  </div>

  <!-- æ–°å¢/ç·¨è¼¯è¡¨å–®å°è©±æ¡† -->
  <kendo-dialog 
    *ngIf="showAddForm"
    [title]="editingStore ? 'ç·¨è¼¯åº—å®¶' : 'æ–°å¢åº—å®¶'"
    (close)="cancelEdit()"
    class="store-form-dialog"
    [width]="500"
  >
    <div class="form-content">
      <!-- åº—å®¶åç¨± -->
      <div class="form-group">
        <label class="form-label">åº—å®¶åç¨± *</label>
        <input 
          kendoTextBox 
          [(ngModel)]="formData.name"
          placeholder="è«‹è¼¸å…¥åº—å®¶åç¨±"
          class="form-input"
        />
      </div>

      <!-- åº—å®¶é¡å‹ -->
      <div class="form-group">
        <label class="form-label">åº—å®¶é¡å‹ *</label>
        <kendo-dropdownlist
          [(ngModel)]="formData.type"
          [data]="storeTypes"
          textField="label"
          valueField="value"
          class="form-input"
        >
          <ng-template kendoDropDownListItemTemplate let-dataItem>
            <div class="type-option">
              <div class="type-label">{{ dataItem.label }}</div>
              <div class="type-description">{{ dataItem.description }}</div>
            </div>
          </ng-template>
        </kendo-dropdownlist>
      </div>

      <!-- Google åœ°åœ–é€£çµ -->
      <div class="form-group">
        <label class="form-label">Google åœ°åœ–é€£çµ *</label>
        <input 
          kendoTextBox 
          [(ngModel)]="formData.google"
          placeholder="https://goo.gl/maps/..."
          class="form-input"
        />
        <div class="form-hint">
          ğŸ’¡ åœ¨ Google åœ°åœ–ä¸­æ‰¾åˆ°åº—å®¶ï¼Œé»æ“Šã€Œåˆ†äº«ã€â†’ã€Œè¤‡è£½é€£çµã€
        </div>
      </div>

      <!-- é è¦½ -->
      <div class="form-group" *ngIf="formData.name">
        <label class="form-label">é è¦½æ•ˆæœ</label>
        <div class="preview-card">
          <div class="store-visual-preview" 
               [style.background]="getPreviewVisual().gradient">
            <div class="store-emoji-preview">
              {{ getPreviewVisual().emoji }}
            </div>
            <div class="store-initial-preview">
              {{ getPreviewInitial() }}
            </div>
          </div>
          <div class="preview-name">{{ formData.name }}</div>
        </div>
      </div>
    </div>

    <kendo-dialog-actions>
      <button kendoButton (click)="cancelEdit()" themeColor="base">
        å–æ¶ˆ
      </button>
      <button kendoButton (click)="saveStore()" themeColor="primary">
        {{ editingStore ? 'æ›´æ–°' : 'æ–°å¢' }}
      </button>
    </kendo-dialog-actions>
  </kendo-dialog>

  <!-- çµ±è¨ˆè³‡è¨Š -->
  <div class="stats-bar">
    <div class="stat-item">
      <span class="stat-label">ç¸½åº—å®¶æ•¸ï¼š</span>
      <span class="stat-value">{{ stores.length }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">é¡å‹åˆ†å¸ƒï¼š</span>
      <span class="stat-value">
        <span *ngFor="let type of storeTypes; let last = last">
          {{ type.label.substring(0, 2) }}{{ getStoreCountByType(type.value) }}
          <span *ngIf="!last"> | </span>
        </span>
      </span>
    </div>
  </div>
</div>